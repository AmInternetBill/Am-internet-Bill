<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Am Internet - Customer Panel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #e2136e; --secondary: #128c7e; --bg: #f0f2f5; --accent: #007bff; --warning: #ffc107; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; }
        
        .clock-container {
            background: #fff;
            padding: 15px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(226, 19, 110, 0.2);
            border-top: 4px solid var(--primary);
            width: 90%;
        }
        .clock-time { display: block; font-size: 32px; font-weight: 900; color: var(--primary); }
        .clock-date { display: block; font-size: 15px; color: #333; font-weight: bold; margin: 5px 0; }
        .bangla-season { 
            display: inline-block; background: var(--primary); color: white; 
            padding: 3px 12px; border-radius: 50px; font-size: 13px; font-weight: bold;
        }

        .header { text-align: center; padding: 10px 0; }
        .header h1 { 
            font-size: 45px; margin: 0; color: #fff; text-transform: uppercase;
            text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        .designer-tag {
            font-size: 18px; color: #333; font-weight: bold; margin-top: 5px;
            letter-spacing: 1px; text-transform: uppercase; display: block;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
            to { text-shadow: 0 0 20px var(--primary), 0 0 40px #ff4d94; }
        }
        
        .header p { color: #555; font-size: 14px; margin-top: 15px; line-height: 1.5; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 25px; border-top: 5px solid var(--primary); }
        .card.complain-card { border-top-color: var(--secondary); }
        .card.service-card { border-top-color: var(--accent); }
        h3 { margin-top: 0; color: #333; display: flex; align-items: center; gap: 10px; font-size: 18px; }
        .toggle-btn { background: #f8f9fa; color: #333; border: 1px solid #ddd; cursor: pointer; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; margin-bottom: 5px; }
        #serviceList, #complainForm { display: none; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; }
        .service-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f9f9f9; }
        .call-btn { background: var(--accent); color: white; text-decoration: none; padding: 5px 12px; border-radius: 5px; font-size: 13px; font-weight: bold; }
        
        .method-selector { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .method-selector label { margin: 0; flex: 1; cursor: pointer; }
        .method-selector input { display: none; }
        .method-box { border: 2px solid #ddd; padding: 10px; border-radius: 10px; text-align: center; font-weight: bold; font-size: 12px; display: block; background: white; line-height: 1.4; transition: 0.3s; }
        .method-selector input:checked + .method-box { border-color: var(--primary); background: #fff0f6; color: var(--primary); box-shadow: 0 0 10px rgba(226, 19, 110, 0.1); }

        .warning-text { background: #fff3cd; color: #856404; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: bold; border-left: 5px solid var(--warning); margin-bottom: 15px; text-align: center; }
        label { display: block; margin: 10px 0 5px; font-size: 13px; font-weight: 600; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; outline: none; }
        .id-hint { font-size: 11px; color: var(--primary); font-weight: bold; margin-bottom: 5px; }
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; margin-top: 15px; transition: 0.3s; font-size: 16px; }
        .btn-pay { background: var(--primary); }
        .btn-comp { background: var(--secondary); }
        .btn-admin { background: #555; margin-top: 30px; opacity: 0.6; font-size: 14px; }
        .btn-status { background: #2196F3; margin-top: 10px; }
        #adminDashboard { display: none; max-width: 1200px; margin: auto; padding: 20px; }
        .table-wrapper { width: 100%; overflow-x: auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #333; color: white; }
        #passChangeSection { display: none; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 20px; }
        .toggle-pass-btn { background: #444; color: white; padding: 8px 15px; border-radius: 5px; font-size: 12px; cursor: pointer; border: none; margin-bottom: 10px; width: auto; }
        
        /* Delete Button - ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
        .del-btn { 
            background: #ff4d4d !important; 
            color: white !important; 
            border: none !important; 
            padding: 8px 15px !important; 
            border-radius: 5px !important; 
            cursor: pointer !important; 
            font-size: 12px !important; 
            font-weight: bold !important;
            margin: 2px !important;
            transition: 0.3s !important;
            display: inline-block !important;
            width: auto !important;
        }
        .del-btn:hover { background: #cc0000 !important; transform: translateY(-2px) !important; }
        
        /* Confirm/Reject Button Styles */
        .btn-confirm { 
            background: #4CAF50 !important; 
            color: white !important; 
            border: none !important; 
            padding: 8px 15px !important; 
            border-radius: 5px !important; 
            cursor: pointer !important; 
            font-size: 12px !important; 
            font-weight: bold !important;
            margin: 2px !important;
            transition: 0.3s !important;
            display: inline-block !important;
            width: auto !important;
        }
        .btn-confirm:hover { background: #388E3C !important; transform: translateY(-2px) !important; }
        
        .btn-reject { 
            background: #f44336 !important; 
            color: white !important; 
            border: none !important; 
            padding: 8px 15px !important; 
            border-radius: 5px !important; 
            cursor: pointer !important; 
            font-size: 12px !important; 
            font-weight: bold !important;
            margin: 2px !important;
            transition: 0.3s !important;
            display: inline-block !important;
            width: auto !important;
        }
        .btn-reject:hover { background: #d32f2f !important; transform: translateY(-2px) !important; }
        
        /* Status Badges */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
        }
        .status-pending { 
            background: #FFF3E0; 
            color: #EF6C00; 
            border: 1px solid #FF9800; 
        }
        .status-confirmed { 
            background: #E8F5E9; 
            color: #2E7D32; 
            border: 1px solid #4CAF50; 
        }
        .status-rejected { 
            background: #FFEBEE; 
            color: #C62828; 
            border: 1px solid #f44336; 
        }
        
        /* Customer Status Card */
        .status-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        
        .section-title { background: #333; color: white; padding: 10px; border-radius: 5px; margin-bottom: 10px; text-align: center; }
        
        /* Stats Summary - TOTAL TK Box ‡¶∏‡¶π */
        .stats-summary { 
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            text-align: center; 
            border-bottom: 4px solid var(--primary);
            transition: 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-card.total-amount {
            border-bottom: 4px solid #4CAF50;
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
        }
        .stat-card span { 
            display: block; 
            font-size: 13px; 
            color: #666; 
            font-weight: bold;
            margin-bottom: 8px;
        }
        .stat-card b { 
            font-size: 22px; 
            color: var(--primary);
            display: block;
        }
        .stat-card.total-amount b {
            color: #2E7D32;
            font-size: 24px;
        }
        
        /* Stats Dropdown Styles */
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 15px;
            background: #333;
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .stats-header h3 {
            margin: 0;
            color: white !important;
            font-size: 16px;
        }

        .stats-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: auto;
            margin: 0;
        }

        .stats-container {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .stats-container.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
            padding: 0;
        }

        .stats-container.expanded {
            max-height: 1000px;
            opacity: 1;
            margin-bottom: 20px;
        }
        
        .search-container { margin-bottom: 20px; position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 10px 0; }
        #adminSearch { padding: 15px; border: 2px solid var(--primary); border-radius: 50px; font-weight: bold; }
        .month-select-container { text-align: center; margin: 20px 0; }
        #monthSelector { padding: 15px 30px; border-radius: 50px; background: var(--primary); color: white; border: none; font-size: 18px; font-weight: bold; cursor: pointer; outline: none; box-shadow: 0 4px 10px rgba(226, 19, 110, 0.3); }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-title {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        .modal-close:hover {
            color: var(--primary);
        }
        
        /* Action Buttons Container */
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Complaint Table Action Buttons */
        .comp-action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="header">
        <div class="clock-container">
            <span class="clock-time" id="liveTimeBN">‡ß¶‡ß¶:‡ß¶‡ß¶:‡ß¶‡ß¶</span>
            <span class="clock-date" id="liveDateBN">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
            <span class="bangla-season" id="banglaSeason">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</span>
        </div>
        
        <h1>Am Internet</h1>
        <span class="designer-tag">Design by Salman</span>
        <p>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ó‡¶§‡¶ø‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡ßá‡¶¨‡¶æ ‡¶ì ‡¶®‡¶ø‡¶∞‡¶¨‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶® ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø‡•§</p>
    </div>

    <div id="userPage">
        <!-- Bill Payment Section - TOP -->
        <div class="card">
            <h3>üí≥ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶¨‡¶ø‡¶≤ ‡¶™‡ßá</h3>
            <div class="warning-text">‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ: ‡¶®‡¶ø‡¶ö‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶® ‡¶∏‡ßá‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
            
            <div class="method-selector">
                <label>
                    <input type="radio" name="payMethod" value="01918677744 (P)">
                    <span class="method-box">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤<br>01918677744</span>
                </label>
                <label>
                    <input type="radio" name="payMethod" value="01703134988 (M)">
                    <span class="method-box">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü<br>01703134988</span>
                </label>
            </div>

            <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø (‡ß´ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü)</label>
            <div class="id-hint">‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: 28001</div>
            <input type="number" id="payId" value="28" placeholder="28XXX">
            <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü)</label>
            <input type="number" id="payPhone" placeholder="01XXXXXXXXX">
            <label>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="payAmount" placeholder="‡ß´‡ß¶‡ß¶">
            <label>‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø (TrxID)</label><input type="text" id="payTrx" placeholder="8N76VL...">
            <button class="btn-pay" onclick="submitData('BILL')">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
        </div>

        <!-- Payment Status Check -->
        <div class="card">
            <h3>üìä ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï</h3>
            <label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</label>
            <input type="number" id="statusCheckId" placeholder="28001" value="28">
            <button class="btn-status" onclick="checkPaymentStatus()">
                üîç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            
            <div id="statusResult" style="display: none; margin-top: 20px;">
                <!-- Status results will be shown here -->
            </div>
        </div>

        <!-- Customer Support Section -->
        <div class="card service-card">
            <h3>üìû ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
            <button class="toggle-btn" onclick="toggleService()">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‚ñº</button>
            <div id="serviceList">
                <div class="service-item"><span>‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡ßß‡¶∞‡¶æ‡ßü‡¶π‡¶æ‡¶®</span> <a href="tel:01308667489" class="call-btn">‡¶ï‡¶≤ ‡¶¶‡¶ø‡¶®</a></div>
                <div class="service-item"><span>‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡ß®‡¶Ö‡¶≤‡¶ø</span> <a href="tel:01308667487" class="call-btn">‡¶ï‡¶≤ ‡¶¶‡¶ø‡¶®</a></div>
                <div class="service-item"><span>‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡ß©‡¶∏‡¶æ‡¶ó‡¶∞</span> <a href="tel:01308667490" class="call-btn">‡¶ï‡¶≤ ‡¶¶‡¶ø‡¶®</a></div>
            </div>
        </div>

        <!-- Complaint Box Section -->
        <div class="card complain-card">
            <h3>‚ö†Ô∏è ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ï‡ßç‡¶∏</h3>
            <button class="toggle-btn" onclick="toggleComplain()">‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‚ñº</button>
            <div id="complainForm">
                <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø (‡ß´ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü)</label>
                <input type="number" id="compName" value="28" placeholder="28XXX">
                <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü)</label>
                <input type="number" id="compPhone" placeholder="01XXXXXXXXX">
                <label>‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶®</label>
                <select id="compType">
                    <option>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡¶≤‡ßá ‡¶®‡¶æ</option><option>‡¶∏‡ßç‡¶™‡¶ø‡¶° ‡¶Ö‡¶®‡ßá‡¶ï ‡¶ï‡¶Æ</option><option>‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶™‡ßú‡ßá‡¶õ‡ßá</option><option>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ</option>
                </select>
                <label>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</label><textarea id="compMsg" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..."></textarea>
                <button class="btn-comp" onclick="submitData('COMPLAIN')">‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
            </div>
        </div>
        
        <!-- Admin Login Button -->
        <button class="btn-admin" onclick="showLogin()">üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</button>
    </div>

    <div id="adminLogin" class="card" style="display:none;">
        <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
        <input type="text" id="adminUser" placeholder="Username">
        <input type="password" id="adminPass" placeholder="Password">
        <button class="btn-pay" onclick="checkLogin()">‡¶≤‡¶ó‡¶á‡¶®</button>
    </div>
</div>

<!-- Admin Dashboard -->
<div id="adminDashboard">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h2>‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
        <button onclick="location.reload()" style="background:red; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
    </div>
    
    <button class="toggle-pass-btn" onclick="togglePassBox()">‚öôÔ∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <div id="passChangeSection">
        <div style="display:flex; gap:10px; align-items: center;">
            <input type="password" id="newPass" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" style="padding:8px; margin:0; flex:1;">
            <button onclick="changePassword()" style="margin:0; width:120px; background:var(--primary); padding:10px; font-size:14px;">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div class="month-select-container">
        <select id="monthSelector" onchange="loadMonthData()">
        </select>
    </div>

    <!-- Stats Summary with Dropdown -->
    <div style="margin-bottom: 20px;">
        <div class="stats-header" onclick="toggleStats()">
            <h3>üìä ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</h3>
            <button class="stats-toggle-btn" id="statsToggleBtn">‚ñº</button>
        </div>
        
        <div class="stats-container expanded" id="statsContainer">
            <div class="stats-summary">
                <div class="stat-card">
                    <span>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</span>
                    <b id="totalBillCount">0</b>
                </div>
                <div class="stat-card">
                    <span>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
                    <b id="pendingBillCount">0</b>
                </div>
                <div class="stat-card">
                    <span>‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡¶° ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
                    <b id="confirmedBillCount">0</b>
                </div>
                <div class="stat-card">
                    <span>‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
                    <b id="rejectedBillCount">0</b>
                </div>
                <div class="stat-card total-amount">
                    <span>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡¶ï‡ßÉ‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                    <b id="totalAmount">0 TK</b>
                </div>
                <div class="stat-card" style="border-bottom-color: #2196F3;">
                    <span>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó</span>
                    <b id="totalComplaints">0</b>
                </div>
            </div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="adminSearch" placeholder="üîç ‡¶Ü‡¶á‡¶°‡¶ø, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ TrxID ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="filterData()">
    </div>

    <h3 class="section-title">üí≥ ‡¶¨‡¶ø‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                    <th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                    <th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                    <th>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                    <th>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                    <th>TrxID</th>
                    <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                    <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                </tr>
            </thead>
            <tbody id="billTableBody">
                <!-- Payment data will be loaded here -->
            </tbody>
        </table>
    </div>

    <h3 class="section-title">‚ö†Ô∏è ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                    <th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                    <th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                    <th>‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶®</th>
                    <th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</th>
                    <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                </tr>
            </thead>
            <tbody id="compTableBody">
                <!-- Complaint data will be loaded here -->
            </tbody>
        </table>
    </div>
</div>

<!-- Verify Modal -->
<div id="verifyModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeVerifyModal()">&times;</span>
        <div class="modal-title">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</div>
        <div style="margin: 20px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø:</strong></span>
                <span id="verifyUserId"></span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>TrxID:</strong></span>
                <span id="verifyTrxId" style="font-family: monospace;"></span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</strong></span>
                <span id="verifyAmount" style="color: var(--primary); font-weight: bold;"></span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</strong></span>
                <span id="verifyPhone"></span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</strong></span>
                <span id="verifyMethod"></span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span><strong>‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º:</strong></span>
                <span id="verifyTime"></span>
            </div>
        </div>
        <div style="margin-top: 25px;">
            <button class="btn-confirm" onclick="confirmPayment()" style="width: 100%; padding: 12px; font-size: 16px; background: #4CAF50 !important;">
                ‚úÖ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <button class="btn-reject" onclick="showRejectReason()" style="width: 100%; padding: 12px; font-size: 16px; margin-top: 10px; background: #f44336 !important;">
                ‚ùå ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>
</div>

<!-- Reject Reason Modal -->
<div id="rejectModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeRejectModal()">&times;</span>
        <div class="modal-title">‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£</div>
        <div style="margin: 20px 0;">
            <select id="rejectReason" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                <option value="‡¶≠‡ßÅ‡¶≤ TrxID">‡¶≠‡ßÅ‡¶≤ TrxID</option>
                <option value="‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶ø ‡¶π‡ßü‡¶®‡¶ø">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶ø ‡¶π‡ßü‡¶®‡¶ø</option>
                <option value="‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø">‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</option>
                <option value="‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü">‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</option>
                <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
            </select>
            <textarea id="customReason" placeholder="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; display: none; min-height: 80px;"></textarea>
        </div>
        <div>
            <button class="btn-reject" onclick="submitReject()" style="width: 100%; padding: 12px; font-size: 16px; background: #f44336 !important;">
                ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCFBj-6URVjyCsO3ERZQGroPi1eWAUaV6M",
        authDomain: "sallu-c83fa.firebaseapp.com",
        databaseURL: "https://sallu-c83fa-default-rtdb.firebaseio.com",
        projectId: "sallu-c83fa",
        storageBucket: "sallu-c83fa.firebasestorage.app",
        messagingSenderId: "631719412254",
        appId: "1:631719412254:web:67b174371e595644a6e40f"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Global Variables
    let currentPaymentKey = null;
    let currentPaymentData = null;
    
    // Live Clock Function
    function updateClock() {
        const now = new Date();
        const timeBN = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
        const dayNamesBN = ["‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞", "‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞", "‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞"];
        const monthNamesBN = ["‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", "‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤", "‡¶Æ‡ßá", "‡¶ú‡ßÅ‡¶®", "‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á", "‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü", "‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞", "‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞"];
        const day = dayNamesBN[now.getDay()];
        const date = now.getDate().toLocaleString('bn-BD');
        const month = monthNamesBN[now.getMonth()];
        const year = now.getFullYear().toLocaleString('bn-BD').replace(/,/g, '');
        document.getElementById('liveTimeBN').innerText = timeBN;
        document.getElementById('liveDateBN').innerText = `üìÖ ${day}, ${date} ${month} ${year}`;
        const m = now.getMonth();
        if(m == 0 || m == 1) document.getElementById('banglaSeason').innerText = "‡¶Æ‡¶æ‡¶ò ‡¶Æ‡¶æ‡¶∏ | ‡¶∂‡ßÄ‡¶§‡¶ï‡¶æ‡¶≤ ‚ùÑÔ∏è";
        else document.getElementById('banglaSeason').innerText = "‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶∏ | ‡¶¨‡¶∏‡¶®‡ßç‡¶§‡¶ï‡¶æ‡¶≤ üå∏";
    }
    setInterval(updateClock, 1000);
    updateClock();

    const monthNamesEN = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const curMonthYear = monthNamesEN[new Date().getMonth()] + " " + new Date().getFullYear();
    const tgToken = "7741891698:AAHaxBEa2_utaOzOPJdGUzOcOBnxzijfH8w";
    const tgChatId = "7067123155";

    // Toggle Functions
    function togglePassBox() { 
        const box = document.getElementById('passChangeSection'); 
        box.style.display = (box.style.display === 'block') ? 'none' : 'block'; 
    }
    
    function toggleService() { 
        var list = document.getElementById("serviceList"); 
        var btn = document.querySelector(".service-card .toggle-btn"); 
        if (list.style.display === "block") { 
            list.style.display = "none"; 
            btn.innerHTML = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‚ñº"; 
        } else { 
            list.style.display = "block"; 
            btn.innerHTML = "‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‚ñ≤"; 
        } 
    }
    
    function toggleComplain() { 
        var form = document.getElementById("complainForm"); 
        var btn = document.querySelector(".complain-card .toggle-btn"); 
        if (form.style.display === "block") { 
            form.style.display = "none"; 
            btn.innerHTML = "‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‚ñº"; 
        } else { 
            form.style.display = "block"; 
            btn.innerHTML = "‡¶´‡¶∞‡¶Æ‡¶ü‡¶ø ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‚ñ≤"; 
        } 
    }

    // Submit Payment/Complaint Data
    function submitData(type) {
        const inputId = (type === 'BILL') ? document.getElementById('payId').value : document.getElementById('compName').value;
        const phoneNum = (type === 'BILL') ? document.getElementById('payPhone').value : document.getElementById('compPhone').value;
        
        if(type === 'BILL') {
            const amt = document.getElementById('payAmount').value;
            const trx = document.getElementById('payTrx').value;
            const methodEl = document.querySelector('input[name="payMethod"]:checked');
            if(!methodEl) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!");
            const methodValue = methodEl.value;

            if(!inputId || !phoneNum || !amt || !trx) return alert("‡¶∏‡¶¨ ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
            if (inputId.length !== 5 || !inputId.startsWith("28")) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø! ‡¶Ü‡¶á‡¶°‡¶ø ‡ß´ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡ß®‡ßÆ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá");
            if (phoneNum.length !== 11) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞! ‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá");

            // Add status field to payload
            let payload = { 
                type: type, 
                month: curMonthYear, 
                time: new Date().toLocaleString('bn-BD'), 
                id: inputId, 
                phone: phoneNum, 
                amt: amt, 
                trx: trx, 
                method: methodValue,
                status: "pending", // New field
                timestamp: Date.now() // Timestamp
            };
            
            let tgMsg = `üí∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë§ ‡¶Ü‡¶á‡¶°‡¶ø: ${payload.id}\nüíµ ‡¶ü‡¶æ‡¶ï‡¶æ: ${payload.amt} TK\nüßæ TrxID: ${payload.trx}\nüì≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: ${payload.method}\nüìû ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${payload.phone}\nüîÑ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç`;

            db.ref("records").push().set(payload).then(() => { 
                fetch(`https://api.telegram.org/bot${tgToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(tgMsg)}`)
                .then(() => { 
                    alert("‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶§‡ßá '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï' ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); 
                    // Clear form
                    document.getElementById('payPhone').value = '';
                    document.getElementById('payAmount').value = '';
                    document.getElementById('payTrx').value = '';
                });
            });
        } else {
            const msg = document.getElementById('compMsg').value;
            if(!inputId || !phoneNum || !msg) return alert("‡¶∏‡¶¨ ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
            if (inputId.length !== 5 || !inputId.startsWith("28")) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø! ‡¶Ü‡¶á‡¶°‡¶ø ‡ß´ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡ß®‡ßÆ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá");
            if (phoneNum.length !== 11) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞! ‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá");

            let payload = { 
                type: type, 
                month: curMonthYear, 
                time: new Date().toLocaleString('bn-BD'), 
                id: inputId, 
                phone: phoneNum, 
                issue: document.getElementById('compType').value, 
                msg: msg 
            };
            
            let tgMsg = `‚ö†Ô∏è ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë§ ‡¶Ü‡¶á‡¶°‡¶ø: ${payload.id}\nüìû ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${payload.phone}\n‚ùì ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ${payload.issue}\nüìù ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§: ${payload.msg}`;

            db.ref("records").push().set(payload).then(() => { 
                fetch(`https://api.telegram.org/bot${tgToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(tgMsg)}`)
                .then(() => { 
                    alert("‚úÖ ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!‡¶∂‡¶ø‡¶ó‡ßç‡¶∞‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶®‡¶ø‡¶ß‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨‡ßá"); 
                    // Clear form
                    document.getElementById('compPhone').value = '';
                    document.getElementById('compMsg').value = '';
                });
            });
        }
    }

    // ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function checkPaymentStatus() {
        const userId = document.getElementById('statusCheckId').value;
        if(!userId || userId.length !== 5) {
            alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡ß´ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
            return;
        }
        
        const statusResult = document.getElementById('statusResult');
        statusResult.innerHTML = '<div style="text-align: center; padding: 20px;"><i>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</i></div>';
        statusResult.style.display = 'block';
        
        db.ref("records").orderByChild("id").equalTo(userId).once("value", (snap) => {
            if(!snap.exists()) {
                statusResult.innerHTML = `
                    <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center;">
                        <h4 style="color: #c62828;">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</h4>
                        <p>‡¶è‡¶á ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            let hasPayments = false;
            
            snap.forEach((child) => {
                const data = child.val();
                if(data.type === 'BILL') {
                    hasPayments = true;
                    
                    let statusText = "";
                    let statusClass = "";
                    let statusIcon = "";
                    
                    if(data.status === "pending") {
                        statusText = "‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç";
                        statusClass = "status-pending";
                        statusIcon = "‚è≥";
                    } else if(data.status === "confirmed") {
                        statusText = "‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡¶°";
                        statusClass = "status-confirmed";
                        statusIcon = "‚úÖ";
                    } else if(data.status === "rejected") {
                        statusText = "‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°";
                        statusClass = "status-rejected";
                        statusIcon = "‚ùå";
                    } else {
                        statusText = "‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç";
                        statusClass = "status-pending";
                        statusIcon = "‚è≥";
                    }
                    
                    html += `
                        <div class="status-card">
                            <div class="status-item">
                                <span>TrxID:</span>
                                <span><strong>${data.trx || 'N/A'}</strong></span>
                            </div>
                            <div class="status-item">
                                <span>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</span>
                                <span><strong>${data.amt} TK</strong></span>
                            </div>
                            <div class="status-item">
                                <span>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</span>
                                <span>${data.method || 'N/A'}</span>
                            </div>
                            <div class="status-item">
                                <span>‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span>
                                <span>${data.time}</span>
                            </div>
                            <div class="status-item">
                                <span>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</span>
                                <span class="status-badge ${statusClass}">${statusIcon} ${statusText}</span>
                            </div>
                            ${data.verifiedAt ? `<div class="status-item"><span>‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span><span>${data.verifiedAt}</span></div>` : ''}
                            ${data.rejectReason ? `<div class="status-item"><span>‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡¶£:</span><span style="color: #f44336;">${data.rejectReason}</span></div>` : ''}
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            
            if(!hasPayments) {
                html = `
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center;">
                        <h4 style="color: #ef6c00;">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á</h4>
                        <p>‡¶è‡¶á ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>
                    </div>
                `;
            }
            
            statusResult.innerHTML = html;
        });
    }

    // Admin Login
    function showLogin() { 
        document.getElementById('userPage').style.display = 'none'; 
        document.getElementById('adminLogin').style.display = 'block'; 
    }
    
    function checkLogin() {
        const u = document.getElementById('adminUser').value;
        const p = document.getElementById('adminPass').value;
        db.ref("admin_config/pass").once("value").then((snap) => {
            if(u === "Sallu" && p === (snap.val() || "Sallu12")) {
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                initMonthSelector();
            } else { 
                alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!"); 
            }
        });
    }
    
    function changePassword() { 
        const newPass = document.getElementById('newPass').value; 
        if(newPass.length < 4) return alert("‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶¶‡¶ø‡¶®!"); 
        db.ref("admin_config/pass").set(newPass).then(() => { 
            alert("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); 
            togglePassBox(); 
            document.getElementById('newPass').value = ""; 
        }); 
    }
    
    function initMonthSelector() {
        const selector = document.getElementById('monthSelector');
        selector.innerHTML = "<option value='ALL'>‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</option>";
        monthNamesEN.forEach(m => {
            let mY = m + " " + new Date().getFullYear();
            let opt = document.createElement('option');
            opt.value = mY; opt.innerHTML = mY;
            if(mY === curMonthYear) opt.selected = true;
            selector.appendChild(opt);
        });
        loadMonthData();
    }
    
    function filterData() {
        let input = document.getElementById('adminSearch').value.toLowerCase();
        let trs = document.querySelectorAll("#billTableBody tr, #compTableBody tr");
        trs.forEach(tr => tr.style.display = tr.textContent.toLowerCase().includes(input) ? "" : "none");
    }
    
    // ‚úÖ Delete Record Function - ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    function deleteRecord(key, type = 'bill') {
        if(confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ${type === 'bill' ? '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü' : '‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó'} ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
            db.ref("records/" + key).remove().then(() => {
                alert("‚úÖ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                loadMonthData();
            }).catch(error => {
                alert("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + error.message);
            });
        }
    }
    
    // ‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶®
    function verifyPayment(key) {
        console.log("verifyPayment called with key:", key);
        
        db.ref("records/" + key).once("value", (snap) => {
            if(!snap.exists()) {
                alert("Payment not found in database!");
                return;
            }
            
            const data = snap.val();
            console.log("Payment data found:", data);
            
            currentPaymentKey = key;
            currentPaymentData = data;
            
            document.getElementById('verifyUserId').textContent = data.id || "N/A";
            document.getElementById('verifyTrxId').textContent = data.trx || "N/A";
            document.getElementById('verifyAmount').textContent = (data.amt || "0") + " TK";
            document.getElementById('verifyPhone').textContent = data.phone || "N/A";
            document.getElementById('verifyMethod').textContent = data.method || "N/A";
            document.getElementById('verifyTime').textContent = data.time || "N/A";
            
            document.getElementById('verifyModal').style.display = 'flex';
        }).catch(error => {
            console.error("Error loading payment:", error);
            alert("Error loading payment: " + error.message);
        });
    }
    
    function closeVerifyModal() {
        document.getElementById('verifyModal').style.display = 'none';
        currentPaymentKey = null;
        currentPaymentData = null;
    }
    
    // ‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®
    function confirmPayment() {
        console.log("confirmPayment called, currentPaymentKey:", currentPaymentKey);
        
        if(!currentPaymentKey) {
            alert("Error: No payment selected!");
            return;
        }
        
        if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            const updates = {
                status: "confirmed",
                verifiedAt: new Date().toLocaleString('bn-BD'),
                verifiedBy: "Admin",
                verifiedTime: Date.now()
            };
            
            db.ref("records/" + currentPaymentKey).update(updates).then(() => {
                alert("‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                
                // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
                const tgMsg = `‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë§ ‡¶Ü‡¶á‡¶°‡¶ø: ${currentPaymentData.id}\nüíµ ‡¶ü‡¶æ‡¶ï‡¶æ: ${currentPaymentData.amt} TK\nüßæ TrxID: ${currentPaymentData.trx}\nüìû ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${currentPaymentData.phone}\n‚úÖ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡¶æ‡¶á: Admin`;
                fetch(`https://api.telegram.org/bot${tgToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(tgMsg)}`);
                
                closeVerifyModal();
                loadMonthData(); // Reload data
            }).catch((error) => {
                console.error("Error confirming payment:", error);
                alert("Error: " + error.message);
            });
        }
    }
    
    // ‚ùå ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
    function showRejectReason() {
        console.log("showRejectReason called, currentPaymentKey:", currentPaymentKey);
        
        if(!currentPaymentKey) {
            alert("Error: No payment selected!");
            return;
        }
        
        document.getElementById('verifyModal').style.display = 'none';
        document.getElementById('rejectModal').style.display = 'flex';
        
        // Reset custom reason field
        document.getElementById('customReason').style.display = 'none';
        document.getElementById('customReason').value = '';
        
        // Custom reason show/hide
        const rejectReasonSelect = document.getElementById('rejectReason');
        rejectReasonSelect.value = "‡¶≠‡ßÅ‡¶≤ TrxID"; // Reset to default
        
        // Remove any existing event listener
        const newRejectReasonSelect = rejectReasonSelect.cloneNode(true);
        rejectReasonSelect.parentNode.replaceChild(newRejectReasonSelect, rejectReasonSelect);
        
        // Add new event listener
        document.getElementById('rejectReason').addEventListener('change', function() {
            if(this.value === '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø') {
                document.getElementById('customReason').style.display = 'block';
            } else {
                document.getElementById('customReason').style.display = 'none';
            }
        });
    }
    
    function closeRejectModal() {
        document.getElementById('rejectModal').style.display = 'none';
        document.getElementById('verifyModal').style.display = 'none';
        currentPaymentKey = null;
        currentPaymentData = null;
    }
    
    // ‚ùå ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
    function submitReject() {
        console.log("submitReject called, currentPaymentKey:", currentPaymentKey);
        
        if(!currentPaymentKey) {
            alert("Error: No payment selected!");
            return;
        }
        
        let reason = document.getElementById('rejectReason').value;
        if(reason === '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø') {
            reason = document.getElementById('customReason').value;
            if(!reason.trim()) {
                alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
                return;
            }
        }
        
        if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            const updates = {
                status: "rejected",
                rejectedAt: new Date().toLocaleString('bn-BD'),
                rejectedBy: "Admin",
                rejectReason: reason,
                rejectedTime: Date.now()
            };
            
            db.ref("records/" + currentPaymentKey).update(updates).then(() => {
                alert("‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                
                // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
                const tgMsg = `‚ùå ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë§ ‡¶Ü‡¶á‡¶°‡¶ø: ${currentPaymentData.id}\nüíµ ‡¶ü‡¶æ‡¶ï‡¶æ: ${currentPaymentData.amt} TK\nüßæ TrxID: ${currentPaymentData.trx}\nüìû ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${currentPaymentData.phone}\n‚ùå ‡¶ï‡¶æ‡¶∞‡¶£: ${reason}`;
                fetch(`https://api.telegram.org/bot${tgToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(tgMsg)}`);
                
                closeRejectModal();
                loadMonthData(); // Reload data
            }).catch((error) => {
                console.error("Error rejecting payment:", error);
                alert("Error: " + error.message);
            });
        }
    }
    
    // ‚úÖ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
    function loadMonthData() {
        const selectedMonth = document.getElementById('monthSelector').value;
        let query = db.ref("records");
        if (selectedMonth !== "ALL") query = query.orderByChild("month").equalTo(selectedMonth);
        
        query.once("value", (snap) => {
            document.getElementById('billTableBody').innerHTML = "";
            document.getElementById('compTableBody').innerHTML = "";
            
            let count = 0, pending = 0, confirmed = 0, rejected = 0, totalAmount = 0, totalComplaints = 0;
            let billData = [];
            
            snap.forEach((child) => {
                const d = child.val();
                const key = child.key;
                
                if(d.type === 'BILL') {
                    billData.push({key: key, data: d});
                    count++;
                    
                    // Calculate total confirmed amount
                    if(d.status === "confirmed") {
                        totalAmount += parseFloat(d.amt) || 0;
                    }
                    
                    // Count status
                    if(d.status === "pending") pending++;
                    else if(d.status === "confirmed") confirmed++;
                    else if(d.status === "rejected") rejected++;
                    else pending++; // ‡¶Ø‡¶¶‡¶ø status ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
                } else {
                    totalComplaints++;
                    
                    // Complaint row with DELETE button
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${d.time}</td>
                        <td>${d.id}</td>
                        <td>${d.phone}</td>
                        <td>${d.issue}</td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${d.msg}</td>
                        <td>
                            <div class="comp-action-buttons">
                                <button class="del-btn" onclick="deleteRecord('${key}', 'complaint')">
                                    üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
                                </button>
                            </div>
                        </td>
                    `;
                    document.getElementById('compTableBody').prepend(tr);
                }
            });
            
            // Sort by timestamp (newest first)
            billData.sort((a, b) => (b.data.timestamp || 0) - (a.data.timestamp || 0));
            
            // Process bill data
            billData.forEach(item => {
                const d = item.data;
                const key = item.key;
                
                let statusBadge = "";
                if(d.status === "pending") {
                    statusBadge = '<span class="status-badge status-pending">‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</span>';
                } else if(d.status === "confirmed") {
                    statusBadge = '<span class="status-badge status-confirmed">‚úÖ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡¶°</span>';
                } else if(d.status === "rejected") {
                    statusBadge = '<span class="status-badge status-rejected">‚ùå ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°</span>';
                } else {
                    statusBadge = '<span class="status-badge status-pending">‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</span>';
                }
                
                // ‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® - ‡¶∏‡¶¨ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø DELETE button
                let actionButtons = "";
                if(!d.status || d.status === "pending") {
                    actionButtons = `
                        <div class="action-buttons">
                            <button class="btn-confirm" onclick="verifyPayment('${key}')">
                                ‚úÖ Confirm
                            </button>
                            <button class="del-btn" onclick="deleteRecord('${key}', 'bill')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                } else if(d.status === "confirmed") {
                    actionButtons = `
                        <div class="action-buttons">
                            <span style="color: #4CAF50; font-weight: bold; margin-right: 10px;">
                                ‚úÖ Confirmed
                            </span>
                            <button class="del-btn" onclick="deleteRecord('${key}', 'bill')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                } else if(d.status === "rejected") {
                    actionButtons = `
                        <div class="action-buttons">
                            <span style="color: #f44336; font-weight: bold; margin-right: 10px;">
                                ‚ùå Rejected
                            </span>
                            <button class="del-btn" onclick="deleteRecord('${key}', 'bill')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                }
                
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${d.time}</td>
                    <td><strong>${d.id}</strong></td>
                    <td>${d.phone}</td>
                    <td>${d.method || '-'}</td>
                    <td>${d.amt} TK</td>
                    <td><code style="font-size: 11px;">${d.trx}</code></td>
                    <td>${statusBadge}</td>
                    <td>${actionButtons}</td>
                `;
                document.getElementById('billTableBody').appendChild(tr);
            });
            
            // Update stats boxes
            document.getElementById('totalBillCount').innerText = count;
            document.getElementById('pendingBillCount').innerText = pending;
            document.getElementById('confirmedBillCount').innerText = confirmed;
            document.getElementById('rejectedBillCount').innerText = rejected;
            document.getElementById('totalAmount').innerText = totalAmount.toLocaleString() + " TK";
            document.getElementById('totalComplaints').innerText = totalComplaints;
            
            // If no data
            if(count === 0 && totalComplaints === 0) {
                document.getElementById('billTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 50px; color: #999;">
                            ‡¶ï‡ßã‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á
                        </td>
                    </tr>
                `;
                document.getElementById('compTableBody').innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 50px; color: #999;">
                            ‡¶ï‡ßã‡¶® ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á
                        </td>
                    </tr>
                `;
            }
        }).catch(error => {
            console.error("Error loading data:", error);
            alert("Error loading data: " + error.message);
        });
    }

    // Toggle Stats Section
    function toggleStats() {
        const container = document.getElementById('statsContainer');
        const button = document.getElementById('statsToggleBtn');
        
        if(container.classList.contains('expanded')) {
            container.classList.remove('expanded');
            container.classList.add('collapsed');
            button.textContent = '‚ñ∂';
        } else {
            container.classList.remove('collapsed');
            container.classList.add('expanded');
            button.textContent = '‚ñº';
        }
    }
</script>
</body>
</html>
